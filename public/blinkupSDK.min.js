/*! blinkupSDK 0.3.1 2017-06-30 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(c){b.exports=a("./lib/blinkup/blinkupSDK"),c.BU=b.exports,c.BUNetworkConfig=a("./lib/blinkup/NetworkConfig"),c.BUStaticAddressing=a("./lib/blinkup/StaticAddressing"),c.BUNetworkProxy=a("./lib/blinkup/NetworkProxy")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/blinkup/NetworkConfig":10,"./lib/blinkup/NetworkProxy":11,"./lib/blinkup/StaticAddressing":12,"./lib/blinkup/blinkupSDK":13}],2:[function(a,b,c){var d={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,e,f,g,h,i,j="",k=0;for(a=d._utf8_encode(a);k<a.length;)b=a.charCodeAt(k++),c=a.charCodeAt(k++),e=a.charCodeAt(k++),f=b>>2,g=(3&b)<<4|c>>4,h=(15&c)<<2|e>>6,i=63&e,isNaN(c)?h=i=64:isNaN(e)&&(i=64),j=j+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h)+this._keyStr.charAt(i);return j},decode:function(a){var b,c,e,f,g,h,i,j="",k=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");k<a.length;)f=this._keyStr.indexOf(a.charAt(k++)),g=this._keyStr.indexOf(a.charAt(k++)),h=this._keyStr.indexOf(a.charAt(k++)),i=this._keyStr.indexOf(a.charAt(k++)),b=f<<2|g>>4,c=(15&g)<<4|h>>2,e=(3&h)<<6|i,j+=String.fromCharCode(b),64!=h&&(j+=String.fromCharCode(c)),64!=i&&(j+=String.fromCharCode(e));return j=d._utf8_decode(j)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}};b.exports=d},{}],3:[function(a,b,c){"use strict";b.exports=c={};var d={utf8:function(a){return unescape(encodeURIComponent(a))},hexStringToLEBytes:function(a){for(var b=[];a.length;)b=String.fromCharCode(parseInt(a.slice(0,2),16))+b,a=a.slice(2);return b},dottedQuadToLEBytes:function(a){var b="";return a.split(".").forEach(function(a){b+=("0"+parseInt(a,10).toString(16)).slice(-2)}),this.hexStringToLEBytes(b)},dottedQuadToBytes:function(a){var b=[];return a.split(".").forEach(function(a){b+=String.fromCharCode(parseInt(a,10))}),b}};c.utf8=d.utf8,c.hexStringToLEBytes=d.hexStringToLEBytes,c.dottedQuadToLEBytes=d.dottedQuadToLEBytes,c.dottedQuadToBytes=d.dottedQuadToBytes},{}],4:[function(a,b,c){"use strict";function d(a){this.token=a.token,this.planId=a.planId,this.apiKey=a.apiKey,this.environment=a.environment||"production"}b.exports=d},{}],5:[function(a,b,c){"use strict";function d(a){this.agentURL=a.agentURL,this.deviceId=a.deviceId,this.planId=a.planId,this.verificationDate=a.verificationDate}b.exports=d},{}],6:[function(a,b,c){"use strict";var c={};c.isOnMobile=function(a){return a=a||navigator.userAgent,/tablet|pad|mobile|phone|symbian|android|ipod|ios|blackberry|webos/i.test(a)},c.isOnIOS=function(a){return a=a||navigator.userAgent,/(iPhone|iPod|iPod touch|iPad)/i.test(a)&&!c.isOnIE(a)},c.iOSMajorVersion=function(a,b){return c.isOnIOS(b)?(a=a||window,a.indexedDB?8:a.SpeechSynthesisUtterance?7:a.webkitAudioContext?6:a.matchMedia?5:a.history&&"pushState"in a.history?4:3):null},c.isOnChrome=function(a){return a=a||navigator.userAgent,/chrome|crios/i.test(a)&&!c.isOnIE(a)},c.isOnIE=function(a){return a=a||navigator.userAgent,/msie|trident|edge/i.test(a)},c.isOnFirefox=function(a){return a=a||navigator.userAgent,/firefox|seamonkey/i.test(a)},b.exports=c},{}],7:[function(a,b,c){"use strict";function d(a){a=a||{},this.byteArray=a.byteArray||[]}var e=function(a){if(0===a.length)return"";for(var b="",c=0,d=1,e=-1,f=0,g=a.length;g>f;f++)for(e+=8,c=c<<8|a[f];e>=0;){var h=c>>>e&d;h+=1,b+="0"+h.toString(17),e-=1}return b};d.prototype.preambleByteArray=function(){var a=[0,0,0];return a.push(42),a},d.prototype.asciiEncodePreamble=function(){var a=e(this.preambleByteArray());return a},d.prototype.asciiEncode=function(){var a=e(this.byteArray);return a},b.exports=d},{}],8:[function(a,b,c){"use strict";var d=a("./ByteOperations"),e=a("./FlashData"),f={_mCRC:0,flashData:null,PACKET_ID:{WIFI_SSID:1,ENROLMENT:5,DISCONNECT:7,CLEAR_TEXT_PASSWORD:6,NETWORK_STATIC_CONFIG:11,HTTP_PROXY_SETTINGS:13},init:function(a,b,c){var f=2,g=16,h=16,i=20;this._mCRC=0,this.flashData=new e(c);var j=0;d.utf8(b.ssid).length>0&&(j=f+d.utf8(b.ssid).length+f+d.utf8(b.password).length);var k=j+f+g;if(b.addressing&&(k+=f+(b.addressing.dns2?i:h)),b.proxy&&(k+=f+3+d.utf8(b.proxy.server).length,b.proxy.username&&(k+=1+d.utf8(b.proxy.username).length),b.proxy.password&&(k+=1+d.utf8(b.proxy.password).length)),this.appendByte(k),j>0&&this.blinkupWifiCredentials(d.utf8(b.ssid),d.utf8(b.password)),b.addressing){var l=b.addressing;this.blinkupStaticIPConfig(l.ip,l.netmask,l.gateway,l.dns1,l.dns2)}if(b.proxy){var m=b.proxy;this.blinkupProxySettings(m.port,d.utf8(m.server),d.utf8(m.username),d.utf8(m.password))}return this.blinkupEnrolCredentials(a.planId,a.token),this.appendByteNoCRC(this._mCRC>>8),this.appendByteNoCRC(255&this._mCRC),this},initForClearWirelessConfiguration:function(a){return this._mCRC=0,this.flashData=new e(a),this.appendByte(2),this.appendByte(7),this.appendByte(0),this.appendByteNoCRC(this._mCRC>>8),this.appendByteNoCRC(255&this._mCRC),this},initForTest:function(a){return this._mCRC=0,this.flashData=new e(a),this},addToCRC:function(a){this._mCRC=this._mCRC<<8&65535^this.crc16Table[255&(this._mCRC>>8^a)]},appendByteNoCRC:function(a){this.flashData.byteArray.push(a)},appendByte:function(a){this.appendByteNoCRC(a),this.addToCRC(a)},appendEntry:function(a,b){this.appendByte(a),this.appendByte(b.length);for(var c=0;c<b.length;c++)this.appendByte(b.charCodeAt(c))},blinkupEnrolCredentials:function(a,b){a=d.hexStringToLEBytes(a),b=d.hexStringToLEBytes(b),this.appendEntry(this.PACKET_ID.ENROLMENT,a+b)},blinkupWifiCredentials:function(a,b){this.appendEntry(this.PACKET_ID.WIFI_SSID,a),this.appendEntry(this.PACKET_ID.CLEAR_TEXT_PASSWORD,b)},blinkupStaticIPConfig:function(a,b,c,e,f){var g="";g+=d.dottedQuadToBytes(a),g+=d.dottedQuadToBytes(b),g+=d.dottedQuadToBytes(c),g+=d.dottedQuadToBytes(e),f&&(g+=d.dottedQuadToBytes(f)),this.appendEntry(this.PACKET_ID.NETWORK_STATIC_CONFIG,g)},blinkupProxySettings:function(a,b,c,d){var e="";e+=String.fromCharCode(255&a),e+=String.fromCharCode(a>>8&255),e+=String.fromCharCode(b.length),e+=b,c&&(e+=String.fromCharCode(c.length),e+=c),d&&(e+=String.fromCharCode(d.length),e+=d),this.appendEntry(this.PACKET_ID.HTTP_PROXY_SETTINGS,e)},crc16Table:[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448]};b.exports=f},{"./ByteOperations":3,"./FlashData":7}],9:[function(a,b,c){(function(c){"use strict";var d=a("./Environment"),e=a("./FlashPacket"),f={flashBits:null,preambleFlashBits:null,mPos:0,mPreamblePos:0,mWidth:0,mHeight:0,stopFlashing:!1,cb:null,animator:null,drawNextFrame:null,alphaDiv:null,useAlphaFlash:!1,currentProgress:0,lastframeTime:0,minFPSInterval:50,maxFPS:60,drawValues:null,preambleDrawValues:null,generateDrawValueArray:function(a){var b=[0,191,255],c=b.map(function(b){if(a)return 1-b/255;var c=("0"+b.toString(16)).slice(-2);return"#"+c+c+c});return c},findAnimationMethod:function(){for(var a=c.requestAnimationFrame,b=["Webkit","Moz","ms","O"],d=0;d<b.length&&!a;d++)a=c[b[d]+"RequestAnimationFrame"];a?(this.animator=null,this.drawNextFrame=a):(this.animator=c.AnimationFrame(this.maxFPS),this.drawNextFrame=this.animator.request)},forceToNewLayer:function(a){var b="translate3d(0,0,0)";a.style.webkitTransform=b,a.style.MozTransform=b,a.style.msTransform=b,a.style.OTransform=b,a.style.transform=b,a.style.willChange="transform, opacity"},getAlphaDiv:function(a){var b=c.getComputedStyle(a.parentElement).getPropertyValue("background-color");return"rgb(255, 255, 255)"!==b&&(a.parentElement.style.backgroundColor="#FFFFFF",console.log("BU: BU-canvas must be placed in a parent that has a white background color.")),a},getBox:function(){var a=document.getElementById("BU-canvas");this.mWidth=a.width,this.mHeight=a.height,this.forceToNewLayer(a),a.style.zIndex=0;var b=a.getContext("2d");return b.imageSmoothingEnabled=!1,b.msImageSmoothingEnabled=!1,this.useAlphaFlash=d.isOnChrome(),this.useAlphaFlash&&(this.alphaDiv=this.getAlphaDiv(a)),b.fillStyle=this.black,b.fillRect(0,0,this.mWidth,this.mHeight),c.BUInteralFlashState=this,b},testSendBitData:function(a){for(var b=[],c=!0;c;){var d=0,e=0;a.mPreamblePos<a.preambleFlashBits.length?(d=parseInt(a.preambleFlashBits[a.mPreamblePos],17),e=a.preambleDrawValues[d],a.mPreamblePos++):(d=parseInt(a.flashBits[a.mPos],17),e=a.drawValues[d],a.mPos++),b.push(e),a.mPos<a.flashBits.length||(c=!1)}return b},sendBitMem:{delta:0,bitValue:0,drawValue:0,progress:0},sendbit:function(a){var b=c.BUInteralFlashState;b._stopFlashing||(b.sendBitMem.delta=a-b.lastframeTime,b.sendBitMem.delta>b.minFPSInterval&&(b.lastframeTime=a-b.sendBitMem.delta%b.minFPSInterval,b.mPreamblePos<b.preambleFlashBits.length?(b.sendBitMem.bitValue=parseInt(b.preambleFlashBits[b.mPreamblePos],17),b.sendBitMem.drawValue=b.preambleDrawValues[b.sendBitMem.bitValue],b.mPreamblePos++):(b.sendBitMem.bitValue=parseInt(b.flashBits[b.mPos],17),b.sendBitMem.drawValue=b.drawValues[b.sendBitMem.bitValue],b.mPos++),b.useAlphaFlash?b.alphaDiv.style.opacity=b.sendBitMem.drawValue:(b.mBox.fillStyle=b.sendBitMem.drawValue,b.mBox.fillRect(0,0,b.mWidth,b.mHeight)),b.sendBitMem.progress=parseInt((b.mPos+b.mPreamblePos)/(b.flashBits.length+b.preambleFlashBits.length)*100,10),b.currentProgress!==b.sendBitMem.progress&&(b.currentProgress=b.sendBitMem.progress,b.progressCallback(b.sendBitMem.progress))),b.mPos<b.flashBits.length?b.drawNextFrame.call(b.animator,c.BUInteralFlashState.sendbit):b.cb())},resetFlashState:function(){this.mPos=0,this.mPreamblePos=0,this.currentProgress=0,this.minFPSInterval=1e3/this.maxFPS,this.progressCallback(0),this.lastframe=0,this._stopFlashing=!1},start:function(a,b,c,d){this.mBox=this.getBox(),this.cb=d;var f=e.init(a,b,c).flashData;this.flashBits=f.asciiEncode(),this.flashBits+="000000",this.drawValues=this.generateDrawValueArray(this.useAlphaFlash),this.preambleFlashBits=f.asciiEncodePreamble(),this.preambleDrawValues=this.generateDrawValueArray(this.useAlphaFlash),this.findAnimationMethod(),this.resetFlashState(),this.sendbit(this.lastframe)},startDisconnect:function(a,b){this.mBox=this.getBox(),this.cb=b;var c=e.initForClearWirelessConfiguration(a).flashData;this.flashBits=c.asciiEncode(),this.flashBits+="000000",this.drawValues=this.generateDrawValueArray(this.useAlphaFlash),this.preambleFlashBits=c.asciiEncodePreamble(),this.preambleDrawValues=this.generateDrawValueArray(this.useAlphaFlash),this.findAnimationMethod(),this.resetFlashState(),this.sendbit(this.lastframe)},testDisconnect:function(a,b){var c=e.initForClearWirelessConfiguration(a).flashData;return this.flashBits=c.asciiEncode(),this.flashBits+="000000",this.drawValues=this.generateDrawValueArray(this.useAlphaFlash),this.preambleFlashBits=c.asciiEncodePreamble(),this.preambleDrawValues=this.generateDrawValueArray(this.useAlphaFlash),this.resetFlashState(),this.testSendBitData(this)},stop:function(){this._stopFlashing=!0},progressCallbackMem:{scale:"",element:null},progressCallback:function(a){this.maxFPS>29||d.isOnFirefox()||(this.progressCallbackMem.scale="translateZ(0) scale("+a/100+",1)",this.progressCallbackMem.element=document.getElementById("BU-progress"),this.progressCallbackMem.element.style.webkitTransform=this.progressCallbackMem.scale,this.progressCallbackMem.element.style.MozTransform=this.progressCallbackMem.scale,this.progressCallbackMem.element.style.msTransform=this.progressCallbackMem.scale,this.progressCallbackMem.element.style.OTransform=this.progressCallbackMem.scale,this.progressCallbackMem.element.style.transform=this.progressCallbackMem.scale)}};b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Environment":6,"./FlashPacket":8}],10:[function(a,b,c){"use strict";function d(a){this.ssid=a.ssid,this.password=a.password||"",this.addressing=a.addressing?new e(a.addressing):null,this.proxy=a.proxy?new f(a.proxy):null}var e=a("./StaticAddressing"),f=a("./NetworkProxy");d.prototype.isComplete=function(){return"string"==typeof this.ssid&&""!==this.ssid},b.exports=d},{"./NetworkProxy":11,"./StaticAddressing":12}],11:[function(a,b,c){"use strict";function d(a){this.server=a.server,this.port=a.port,this.username=a.username||"",this.password=a.password||""}d.prototype.isComplete=function(){return""!==this.server||""!==this.port||""!==this.username||""!==this.password?""!==this.server&&""!==this.port&&!isNaN(parseInt(this.port,10)):!0},b.exports=d},{}],12:[function(a,b,c){"use strict";function d(a){this.ip=a.ip,this.netmask=a.netmask,this.gateway=a.gateway,this.dns1=a.dns1,this.dns2=a.dns2||""}d.prototype.isComplete=function(){return""!==this.ip||""!==this.netmask||""!==this.gateway||""!==this.dns1||""!==this.dns2?!(""===this.ip||""===this.netmask||""===this.gateway||""===this.dns1):!0},b.exports=d},{}],13:[function(a,b,c){"use strict";var d=a("./ConfigId"),e=a("./DeviceInfo"),f=a("./Flasher"),g=a("./Environment"),h=a("./Base64"),i="https://api.electricimp.com",j=!1;b.exports.StaticAddressing=a("./StaticAddressing"),b.exports.NetworkConfig=a("./NetworkConfig"),b.exports.NetworkProxy=a("./NetworkProxy"),b.exports.pollTimeout=60,b.exports.preventFastFlashing=!1;var k=function(){if(!c.preventFastFlashing&&g.isOnMobile()){if(g.isOnIOS()){var a=g.iOSMajorVersion(),b=window.devicePixelRatio>=2;if(null!==a&&7>a)return 30;if(!b)return 30}return 60}return 20};b.exports.progressCallback=null,b.exports.progressCallbackWillOccurr=function(a){var b=k();return"number"==typeof a&&(b=a),b>29||g.isOnFirefox()?!1:!0},b.exports.getConfigId=function(a,b,c,e){if(null===a)return console.log("BU: No API key provided."),e("No API key provided.",null);if("production"!==c)return console.log("BU: environment must be production"),e("Environment must be production",null);var f=h.encode(a),g=i,j={};"production"===c?(g+="/v1/setup_tokens",null!==b&&"string"==typeof b&&(j.plan_id=b)):(g+="/enrol",j.api_key=a),$.ajax({type:"POST",url:g,data:j,crossDomain:!0,beforeSend:function(a){a.setRequestHeader("Authorization","Basic "+f),a.setRequestHeader("X-Requested-With","XMLHttpRequest")},error:function(a,b,c){return 403===a.statusCode().status||400===a.statusCode().status?e("Your API key is invalid for this environment!",null):401===a.statusCode().status?e("The provided API key must be valid and at least 32 alphanumeric characters long.",null):null!==c&&""!==c?e(c,null):e("Possible API Key Error",null)},success:function(b){if(b.valid_token===!1)return e("Invalid API key",null);var f=b.plan_id||b.siteids[0],g=b.id||b.token,h=new d({token:g,planId:f,apiKey:a,environment:c});return e(null,h)}})},b.exports.startNetworkFlash=function(a,b,d,e){"undefined"==typeof e&&(e=d,d={}),d=d||{},"number"==typeof d.fps?f.maxFPS=d.fps:f.maxFPS=k(),"function"==typeof c.progressCallback&&(f.progressCallback=c.progressCallback),f.start(a,b,d,function(){return e()})},b.exports.startDisconnectFlash=function(a,b){"undefined"==typeof b&&(b=a,a={}),a=a||{},"number"==typeof a.fps?f.maxFPS=a.fps:f.maxFPS=k(),"function"==typeof c.progressCallback&&(f.progressCallback=c.progressCallback),f.startDisconnect(a,function(){return b()})},b.exports.stopPolling=function(){j=!0},b.exports.stopFlash=function(){f.stop()},b.exports.pollForDeviceInfo=function(a,b){var d=h.encode(a.apiKey),f=i;"production"===a.environment&&(f+="/v1/setup_tokens/"+a.token),j=!1;var g=!1,k=setTimeout(function(){g=!0},1e3*c.pollTimeout),l=setInterval(function(){return j===!0?(clearTimeout(k),void clearInterval(l)):g?(clearInterval(l),b("Timeout waiting for device to connect",null)):void $.ajax({type:"GET",url:f,beforeSend:function(a){a.setRequestHeader("Authorization","Basic "+d)},error:function(a,c,d){return b(d,null)},success:function(c){if(j===!0||g===!0)return void clearInterval(l);if("production"===a.environment&&""!==c.impee_id){clearInterval(l),clearTimeout(k);var d=new e({agentURL:c.agent_url,deviceId:c.impee_id,planId:c.plan_id,verificationDate:c.claimed_at});return b(null,d)}}})},1e3)}},{"./Base64":2,"./ConfigId":4,"./DeviceInfo":5,"./Environment":6,"./Flasher":9,"./NetworkConfig":10,"./NetworkProxy":11,"./StaticAddressing":12}]},{},[1]);